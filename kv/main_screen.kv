#:kivy 2.1.0
#:import utils utils.calculations

<MainScreen>:
    name: "main"

    FloatLayout:
        canvas.before:
            Color:
                rgba: 0.0, 0.0, 0.0, 1  # Black background
            Rectangle:
                pos: self.pos
                size: self.size

        # Header with profile info (top of screen)
        BoxLayout:
            size_hint: (0.95, None)
            height: 60
            pos_hint: {'center_x': 0.5, 'top': 0.95}
            spacing: 15
            canvas.before:
                Color:
                    rgba: 0.3, 0.3, 0.3, 0.8  # Semi-transparent dark grey background
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [15]
            padding: [20, 10]

            Label:
                text: "Current Character: " + root.current_character
                color: 0.925, 0.941, 0.945, 1  # #ECF0F1
                size_hint_x: 0.7
                font_size: 18
                bold: True
                text_size: self.size
                halign: "left"
                valign: "middle"

            PrimaryButton:
                text: "Change"
                size_hint_x: 0.3
                height: 40
                bg_color: [0.863, 0.078, 0.235, 1]  # Crimson red
                on_press: app.screen_manager.current = "profiles"

        # Primary action buttons (centered in upper area)
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (0.9, None)
            height: 70
            pos_hint: {'center_x': 0.5, 'center_y': 0.7}
            spacing: 15

            PrimaryButton:
                text: "Attack"
                size_hint_x: 1
                height: 70
                font_size: 18
                bold: True
                bg_color: [0.7, 0.1, 0.1, 1]  # Dark red for attack
                on_press: root.initiate_attack_roll()

            PrimaryButton:
                text: "Saving Throw"
                size_hint_x: 1
                height: 70
                font_size: 18
                bold: True
                bg_color: [0.863, 0.078, 0.235, 1]  # Crimson red for saving throw
                on_press: root.initiate_saving_throw()

            PrimaryButton:
                text: "Ability Check"
                size_hint_x: 1
                height: 70
                font_size: 18
                bold: True
                bg_color: [0.863, 0.078, 0.235, 1]  # Crimson red for ability check
                on_press: root.initiate_ability_check()

        # Motion sensor trigger section
        BoxLayout:
            orientation: 'vertical'
            size_hint: (0.7, None)
            height: 70
            pos_hint: {'center_x': 0.5, 'center_y': 0.6}
            spacing: 4

            PrimaryButton:
                text: root.motion_button_text
                size_hint_y: None
                height: 42
                font_size: 18
                bold: True
                bg_color: [0.2, 0.6, 0.3, 1]  # Green tone for sensor action
                on_press: root.start_motion_roll()

            Label:
                text: root.motion_status
                color: 0.8, 0.85, 0.9, 0.85
                font_size: 13
                size_hint_y: None
                height: 24
                text_size: self.size
                halign: "center"
                valign: "middle"

        # Dice buttons section (lower center area)
        BoxLayout:
            orientation: 'vertical'
            size_hint: (0.95, 0.36)
            pos_hint: {'center_x': 0.5, 'center_y': 0.32}
            canvas.before:
                Color:
                    rgba: 0.3, 0.3, 0.3, 0.6  # Semi-transparent dark grey background
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [20]
            padding: [10, 10, 10, 10]

            # Dice grid inside the container
            GridLayout:
                cols: 4
                rows: 2
                spacing: 12
                size_hint: (1, 1)
                padding: [5, 5, 5, 5]

                DiceButton:
                    dice_type: 4
                    text: "d4"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(4)
                
                DiceButton:
                    dice_type: 6
                    text: "d6"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(6)
                
                DiceButton:
                    dice_type: 8
                    text: "d8"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(8)
                
                DiceButton:
                    dice_type: 10
                    text: "d10"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(10)
                
                DiceButton:
                    dice_type: 12
                    text: "d12"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(12)
                
                DiceButton:
                    dice_type: 20
                    text: "d20"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(20)
                
                DiceButton:
                    dice_type: 100
                    text: "d100"
                    size_hint: (1, 1)
                    on_press: root.roll_dice(100)
                
                PrimaryButton:
                    text: "Custom"
                    bg_color: [0.863, 0.078, 0.235, 1]  # Crimson red for custom
                    font_size: 16
                    on_press: root.show_custom_dice_dialog()

        # Bottom section with exit button and app title
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (0.9, None)
            height: 50
            pos_hint: {'center_x': 0.5, 'y': 0.03}
            spacing: 20

            # Exit button (left side)
            PrimaryButton:
                text: "Exit"
                size_hint: (None, None)
                size: (100, 40)
                bg_color: [0.6, 0.2, 0.2, 1]  # Dark red for exit
                font_size: 16
                on_press: app.stop()

            # Spacer to push title to center
            Widget:
                size_hint_x: 1

            # App title/branding (center-right)
            Label:
                text: "D&D Dice Roller"
                color: 0.7, 0.8, 0.9, 0.6  # Subtle branding
                font_size: 16
                size_hint: (None, None)
                size: (200, 30)
                text_size: self.size
                halign: "right"
                valign: "middle"

            # Right spacer for balance
            Widget:
                size_hint: (None, None)
                size: (50, 30)
#:kivy 2.1.0

# kv/roll_screen.kv (updated)
<RollScreen>:
    name: "roll"

    FloatLayout:  # FloatLayout for pos_hint support
        canvas.before:
            Color:
                rgba: 0.0, 0.0, 0.0, 1  # Black background
            Rectangle:
                pos: self.pos
                size: self.size
        
        # Header with title only
        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            height: 50
            pos_hint: {'x': 0, 'top': 1}  # Top of screen
            padding: [15, 0, 15, 0]
            
            Label:
                text: root.roll_description
                color: 0.925, 0.941, 0.945, 1  # #ECF0F1
                font_size: 18
                bold: True
                text_size: self.size
                halign: "center"  # Centered since no back button
                valign: "middle"
        
        # Animation container (bigger, centered in upper area)
        Widget:
            id: animation_container
            size_hint: (0.9, 0.55)  # Increased from 0.4 to 0.55 height, 0.8 to 0.9 width
            pos_hint: {'center_x': 0.5, 'center_y': 0.65}  
            opacity: 1 if root.roll_type != "damage" else 0
            canvas.before:
                Color:
                    rgba: 0.3, 0.3, 0.3, 0.3  # Semi-transparent dark grey background
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [15]
        
        # Result display (bigger, positioned directly below animation)
        BoxLayout:
            size_hint: (1, None)
            height: 90  # Increased from 70 to 90
            pos_hint: {'x': 0, 'y': 0.17}  # Moved down to accommodate bigger animation
            padding: [10, 5, 10, 5]
            
            Label:
                id: result_label
                text: "Preparing roll..."
                color: 0.925, 0.941, 0.945, 1
                font_size: 28  # Increased from 24 to 28
                bold: True
                text_size: self.size
                halign: "center"
                valign: "middle"
                canvas.before:
                    Color:
                        rgba: 0.3, 0.3, 0.3, 0.7  # Semi-transparent dark grey background for better readability
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [10]
        
        # Spacer for damage rolls (positioned where animation would be, bigger)
        Widget:
            size_hint: (0.9, 0.2)  # Increased size to match bigger animation area
            pos_hint: {'center_x': 0.5, 'center_y': 0.65}
            opacity: 0 if root.roll_type != "damage" else 1
        
        # Attack result container (positioned in middle-lower area)
        BoxLayout:
            id: attack_result_container
            size_hint: (1, None)
            height: 100
            pos_hint: {'x': 0, 'y': 0.22}  # Moved down to accommodate bigger result display
            opacity: 1 if root.show_attack_result else 0
            spacing: 10
            padding: [15, 5, 15, 5]
        
        # Follow-up actions container (positioned slightly above buttons)
        BoxLayout:
            id: followup_container
            size_hint: (1, None)
            height: 70
            pos_hint: {'x': 0, 'y': 0.12}  # Moved down to accommodate other changes
            opacity: 1 if root.roll_type == "damage" else 0
            spacing: 15
            padding: [15, 5, 15, 5]
        
        # Action buttons (positioned at bottom)
        BoxLayout:
            size_hint: (1, None)
            height: 60
            pos_hint: {'x': 0, 'y': 0.02}  # Bottom of screen with small margin
            spacing: 15
            padding: [15, 5, 15, 10]
            
            PrimaryButton:
                text: "Roll Again"
                size_hint_x: 0.5
                height: 55
                on_press: root.new_roll()
            
            PrimaryButton:
                text: "New Roll"
                size_hint_x: 0.5
                height: 55
                bg_color: [0.863, 0.078, 0.235, 1]  # Crimson red color
                on_press: root.back_to_main()
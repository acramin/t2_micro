#:kivy 2.2.1

# kv/roll_screen.kv (updated)
<RollScreen>:
    name: "roll"
    
    BoxLayout:
        orientation: "vertical"
        padding: 15
        spacing: 10
        canvas.before:
            Color:
                rgba: 0.173, 0.243, 0.314, 1  # Dark blue background
            Rectangle:
                pos: self.pos
                size: self.size
        
        # Header with title and back button
        BoxLayout:
            size_hint_y: None
            height: 50
            spacing: 16
            
            Label:
                text: root.roll_description
                color: 0.925, 0.941, 0.945, 1  # #ECF0F1
                size_hint_x: 0.7
                font_size: 18
                bold: True
                text_size: self.size
                halign: "left"
                valign: "middle"
            
            PrimaryButton:
                text: "Back"
                size_hint_x: 0.3
                height: 45
                on_press: root.back_to_main()
        
        # Animation container (centered, larger, only for non-damage rolls)
        Widget:
            id: animation_container
            size_hint_y: 0.45
            opacity: 1 if root.roll_type != "damage" else 0
            canvas.before:
                Color:
                    rgba: 0.2, 0.3, 0.4, 0.3  # Semi-transparent background
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [15]
        
        # Spacer for damage rolls
        Widget:
            size_hint_y: 0.1
            opacity: 0 if root.roll_type != "damage" else 1
        
        # Result display
        BoxLayout:
            size_hint_y: None
            height: 70
            padding: [10, 5, 10, 5]
            
            Label:
                id: result_label
                text: "Preparing roll..."
                color: 0.925, 0.941, 0.945, 1
                font_size: 24
                bold: True
                text_size: self.size
                halign: "center"
                valign: "middle"
                canvas.before:
                    Color:
                        rgba: 0.3, 0.4, 0.5, 0.7  # Background for better readability
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [10]
        
        # Critical hit/fail indicator
        Label:
            text: "CRITICAL HIT!" if root.critical_hit else ("CRITICAL FAILURE!" if root.critical_fail else "")
            color: (0.2, 0.8, 0.2, 1) if root.critical_hit else (0.8, 0.2, 0.2, 1)
            font_size: 20
            bold: True
            size_hint_y: None
            height: 45 if root.critical_hit or root.critical_fail else 0
            opacity: 1 if root.critical_hit or root.critical_fail else 0
            canvas.before:
                Color:
                    rgba: (0.2, 0.8, 0.2, 0.4) if root.critical_hit else (0.8, 0.2, 0.2, 0.4)
                RoundedRectangle:
                    pos: self.x + 10, self.y + 2
                    size: self.width - 20, self.height - 4
                    radius: [8]
        
        # Attack result container (hit/miss for attacks)
        BoxLayout:
            id: attack_result_container
            size_hint_y: None
            height: 100 if root.show_attack_result else 0
            opacity: 1 if root.show_attack_result else 0
            spacing: 10
            padding: [15, 5, 15, 5]
        
        # Follow-up actions container (damage roll, etc.)
        BoxLayout:
            id: followup_container
            size_hint_y: None
            height: 70 if root.roll_type == "damage" else 0
            spacing: 15
            padding: [15, 5, 15, 5]
        
        # Spacer to push buttons to bottom
        Widget:
            size_hint_y: 0.1
        
        # Action buttons (always visible at bottom)
        BoxLayout:
            size_hint_y: None
            height: 60
            spacing: 15
            padding: [15, 5, 15, 10]
            
            PrimaryButton:
                text: "Roll Again"
                size_hint_x: 0.5
                height: 55
                on_press: root.new_roll()
                opacity: 1 if not root.show_attack_result else 0
                disabled: root.show_attack_result
            
            PrimaryButton:
                text: "New Roll"
                size_hint_x: 0.5
                height: 55
                bg_color: [0.2, 0.6, 0.8, 1]  # Different color
                on_press: root.back_to_main()
                opacity: 1 if not root.show_attack_result else 0
                disabled: root.show_attack_result